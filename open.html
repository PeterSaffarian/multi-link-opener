<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Link Opener</title>
</head>
<body>

    <h1>Multi-Link Opener</h1>
    <p id="status-message">Processing your request...</p>

    <div id="links-container">
        <h2>Links Opened:</h2>
        <!-- Links will be added here by JavaScript -->
    </div>

    <script>
        // Use a function to handle the logic
        function openLinks() {
            try {
                // Get the current URL and parse the query string
                const urlParams = new URLSearchParams(window.location.search);
                const allParam = urlParams.get('all');

                const statusMessage = document.getElementById('status-message');
                const linksContainer = document.getElementById('links-container');

                if (!allParam) {
                    statusMessage.textContent = 'No "all" parameter found in the URL. Please check the URL format.';
                    return;
                }

                // Decode the URI component and split the links by the pipe character
                const links = decodeURIComponent(allParam).split('|');

                if (links.length === 0) {
                    statusMessage.textContent = 'No valid links found in the URL parameter.';
                    return;
                }

                statusMessage.textContent = `Opening ${links.length} link(s)...`;
                
                // Open the first link in a new window and store a reference to it.
                // We use a unique name ('_newWindow') to ensure all tabs open there.
                let newWindow;
                if (links.length > 0 && links[0].trim() !== '') {
                    newWindow = window.open(links[0], '_newWindow');
                    
                    const linkElement = document.createElement('p');
                    linkElement.textContent = `Opening in new window: ${links[0]}`;
                    linksContainer.appendChild(linkElement);
                }

                // Iterate through the remaining links and open them in the same new window.
                for (let i = 1; i < links.length; i++) {
                    const link = links[i];
                    if (link.trim() !== '') {
                        // Create a list item to show the user which link is being opened
                        const linkElement = document.createElement('p');
                        linkElement.textContent = `Opening in new tab: ${link}`;
                        linksContainer.appendChild(linkElement);

                        // If the new window was successfully created, open subsequent links in it.
                        // We use the same name ('_newWindow') to group the tabs.
                        if (newWindow && !newWindow.closed) {
                            newWindow.open(link, '_newWindow');
                        } else {
                            // Fallback if the first window failed to open
                            window.open(link, '_blank');
                        }
                    }
                }

                statusMessage.textContent = `All ${links.length} link(s) have been processed.`;

                // Attempt to close the current window.
                // Note: This will only work if the window was opened by a script.
                window.close();

            } catch (error) {
                console.error("Error processing links:", error);
                document.getElementById('status-message').textContent = 'An error occurred while trying to open the links.';
            }
        }

        // Call the function when the page loads
        window.onload = openLinks;

    </script>
</body>
</html>
