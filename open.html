<!doctype html>
<meta charset="utf-8">
<title>Opening client links…</title>
<script>
function parseUrls(search) {
  const p = new URLSearchParams(search || location.search);
  let urls = [];
  for (const [k,v] of p) if (k === "u") urls.push(v);
  if (!urls.length && p.get("all")) urls = p.get("all").split("|");
  urls = urls
    .map(decodeURIComponent)
    .map(u => u && (/^https?:\/\//i.test(u) ? u : `https://${u}`))
    .filter(Boolean);
  return [...new Set(urls)];
}

(function main() {
  const params = new URLSearchParams(location.search);
  const isChild = params.get("child") === "1";
  const urls = parseUrls(location.search);
  if (!urls.length) { document.body.textContent = "No URLs provided."; return; }

  if (!isChild) {
    // --- LAUNCHER: open a *separate window* (not just a tab) ---
    // Use size/position features to force a new top-level window with a tab bar.
    const childUrl = new URL(location.href);
    childUrl.searchParams.set("child", "1");

    const features = [
      "noopener", "noreferrer",
      `width=${Math.max(1024, screen.availWidth - 20)}`,
      `height=${Math.max(700,  screen.availHeight - 60)}`,
      "left=0", "top=0", "resizable=1", "scrollbars=1"
    ].join(",");

    const win = window.open(childUrl.toString(), "_blank", features);
    if (!win) { document.body.textContent = "Popup blocked. Allow pop-ups for this site and try again."; return; }

    // Close this launcher tab so only the new window remains
    window.close();
    setTimeout(() => { try { if (!win.closed) document.body.textContent = "Opening your links…"; } catch(e){} }, 300);
    return;
  }

  // --- CHILD: running inside the new window. Open all tabs here. ---
  try {
    // Ensure this window is treated as the active context
    try { window.focus(); } catch(e) {}
    try { window.moveTo(0,0); window.resizeTo(screen.availWidth, screen.availHeight); } catch(e) {}

    // Open remaining URLs as tabs in THIS window (stagger helps Chromium)
    for (let i = 1; i < urls.length; i++) {
      setTimeout(() => { try { window.open(urls[i], "_blank"); } catch(e) {} }, i * 40);
    }

    // Make this window the first tab
    setTimeout(() => { location.replace(urls[0]); }, 15);
  } catch (e) {
    document.body.textContent = "Could not open all tabs. Allow pop-ups and try again.";
  }
})();
</script>
